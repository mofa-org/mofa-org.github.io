---
title: "MoFA ç§»åŠ¨ç«¯æ–¹æ¡ˆæ¢ç´¢"
description: "åˆ†æ MoFA æ™ºèƒ½ä½“æ¡†æ¶åœ¨ç§»åŠ¨ç«¯éƒ¨ç½²é¢ä¸´çš„æŠ€æœ¯æŒ‘æˆ˜"
date: 2025-06-09
author: MoFA å›¢é˜Ÿ
tags: [ç§»åŠ¨ç«¯, æ¶æ„è®¾è®¡, Termux, Android, æŠ€æœ¯æ–¹æ¡ˆ]
---

# MoFA ç§»åŠ¨ç«¯éƒ¨ç½²æ–¹æ¡ˆï¼š

## æŠ€æœ¯æŒ‘æˆ˜

### MoFA çš„ç§»åŠ¨ç«¯åº”ç”¨åœºæ™¯ä¸ä¼ ç»Ÿæœºå™¨äººæ§åˆ¶çš„åŒºåˆ«ï¼š

**æœºå™¨äººæ§åˆ¶åœºæ™¯ç‰¹ç‚¹**ï¼š
- ä½å»¶è¿Ÿçš„ç¡¬ä»¶é€šä¿¡ï¼ˆå¾®ç§’çº§ï¼‰
- å¤§é‡ä¼ æ„Ÿå™¨æ•°æ®å®æ—¶å¤„ç†
- Dora-RS å…±äº«å†…å­˜

**ç§»åŠ¨ç«¯ AI Agent åœºæ™¯ç‰¹ç‚¹**ï¼š
- é€»è¾‘æ¨ç†å’Œå†³ç­–
- ç½‘ç»œæ“ä½œå’Œå±å¹•äº¤äº’ä¸ºä¸»
- å¯¹è¯å’Œä»»åŠ¡è§„åˆ’å¯¼å‘
- å»¶è¿Ÿå®¹å¿åº¦ç›¸å¯¹è¾ƒé«˜ï¼ˆæ¯«ç§’çº§å³okï¼‰

### Dora-RS çš„ç§»æ¤é—®é¢˜

#### ä¸€äº›é—®é¢˜ï¼š

```rust
// Dora å…±äº«å†…å­˜
shared-memory-server (Doraè‡ªæœ‰) 
â”œâ”€â”€ shared_memory_extended = "0.13.0"
â”œâ”€â”€ raw_sync_2 = "0.1.5" 
```

1. **å…±äº«å†…å­˜ä¾èµ–**ï¼šDora ä¾èµ–çš„ `shared_memory_extended` crate åœ¨ç§»åŠ¨å¹³å°æ”¯æŒä¸å®Œæ•´
2. **è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶**ï¼šç§»åŠ¨æ“ä½œç³»ç»Ÿ IPC æœºåˆ¶ä¸æ¡Œé¢ç³»ç»Ÿå·®å¼‚
3. **ARM æ¶æ„é€‚é…**


## æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šTermux + Rootæƒé™ å®Œæ•´ç§»æ¤ï¼ˆDemoé˜¶æ®µï¼‰

#### æŠ€æœ¯æ¶æ„
```
Android Host
â”œâ”€â”€ Termux (å®Œæ•´Arch Linux ç¯å¢ƒ)
â”‚   â”œâ”€â”€ libandroid-shmem (å…±äº«å†…å­˜)
â”‚   â”œâ”€â”€ Rust å·¥å…·é“¾
â”‚   â”œâ”€â”€ Dora-RS å®Œæ•´ç‰ˆ
â”‚   â””â”€â”€ MoFA æ™ºèƒ½ä½“æ¡†æ¶
â””â”€â”€ Host Bridge Appï¼ˆå‚è€ƒAuto.JSï¼‰
    â”œâ”€â”€ å±å¹•æˆªå›¾ API
    â”œâ”€â”€ è§¦æ‘¸æ³¨å…¥ API
    â””â”€â”€ Socket é€šä¿¡æ¡¥æ¥
```

#### åˆ†å±‚éªŒè¯è®¡åˆ’

**åŸºç¡€ç¯å¢ƒ**
```bash
â–¡ Termux å®‰è£…ä¸ Root æƒé™è·å–
â–¡ åŸºç¡€ Linux å‘½ä»¤å¯ç”¨æ€§éªŒè¯
â–¡ ç½‘ç»œè¿æ¥å’Œæ–‡ä»¶ç³»ç»Ÿæƒé™æµ‹è¯•
pkg update && pkg install -y git curl wget
su -c "whoami"  # éªŒè¯ root æƒé™
```

**Rust å·¥å…·é“¾**
```bash
pkg install rust
rustc --version && cargo --version
```

**å…±äº«å†…å­˜**
```bash
# å†…æ ¸æ”¯æŒæ£€æŸ¥
cat /proc/version
ls -la /dev/shm
git clone https://github.com/termux/libandroid-shmem
cd libandroid-shmem && make && make install
gcc test/test.c -o test_shmem && ./test_shmem
```

**Dora**
```bash
git clone https://github.com/dora-rs/dora
cd dora
cargo build --bin dora-daemon
cargo build --bin dora-coordinator

# åŸºç¡€è¿è¡Œæµ‹è¯•
./target/debug/dora-daemon --help
```



**MoFA**
```bash
pip install -e . #å®‰è£…MoFAï¼Œå…·ä½“çœç•¥
python examples/hello_world/hello_world.py
```

#### Host-VM æ¡¥æ¥å±‚è®¾è®¡

**å±å¹•æ•°æ®æµ**ï¼š
```kotlin
// Android Host ç«¯ï¼Œdemo codeï¼Œå°šæœªå®ç°
class ScreenBridge {
    fun captureScreen(): ByteArray {
        val mediaProjection = getMediaProjection()
        val imageReader = ImageReader.newInstance(width, height, ImageFormat.JPEG, 1)
        return compressedImageData
    }
    
    fun sendToVM(data: ByteArray) {
        socket.write(data) // é€šè¿‡ Socket å‘é€åˆ° VM
    }
}
```

**æ“ä½œæŒ‡ä»¤å›ä¼ **ï¼š
```python
# VM ä¸­çš„ MoFA Agentï¼Œdemo codeï¼Œå°šæœªå®ç°
class AndroidOperationNode:
    def __init__(self):
        self.bridge_socket = socket.connect("unix:///tmp/android_bridge")
    
    def click(self, x: int, y: int):
        command = {"action": "click", "x": x, "y": y}
        self.bridge_socket.send(json.dumps(command))
```

### æ–¹æ¡ˆäºŒï¼šåŸç”Ÿ Android é‡è®¾è®¡

#### æ–°æ¶æ„è®¾è®¡
```
Android Native MoFA
â”œâ”€â”€ Zenoh-Kotlin é€šä¿¡å±‚
â”œâ”€â”€ Agent Runtime (Kotlin/Java)
â”œâ”€â”€ æ™ºèƒ½ä½“æ¨¡æ¿ç³»ç»Ÿ (ç®€åŒ–ç‰ˆ)
â”œâ”€â”€ Android Services
â”‚   â”œâ”€â”€ AccessibilityService (å±å¹•æ“ä½œ)
â”‚   â”œâ”€â”€ ScreenCapture (æˆªå›¾æœåŠ¡)
â”‚   â””â”€â”€ ForegroundService (åå°ä¿æ´»)
â””â”€â”€ Mobile Node Hub
    â”œâ”€â”€ AutoJS é›†æˆèŠ‚ç‚¹
    â”œâ”€â”€ UI Automator åŒ…è£…
    â”œâ”€â”€ Intent è°ƒç”¨å™¨
    â””â”€â”€ API è°ƒç”¨èŠ‚ç‚¹
```



## å‰ä¸¤ä¸ªæ–¹æ¡ˆå¯¹æ¯”

| è¯„ä¼°ç»´åº¦ | Termux + Linux | Native é‡è®¾è®¡ | 
|---------|----------------|---------------|
| **å¼€å‘é€Ÿåº¦** | ğŸŸ¢ å¿«é€Ÿå¤ç”¨ç°æœ‰ä»£ç  | ğŸ”´ éœ€è¦å®Œå…¨é‡å†™ |  
| **è¿è¡Œæ€§èƒ½** | ğŸ”´ åŒå±‚è™šæ‹ŸåŒ–å¼€é”€ | ğŸŸ¢ åŸç”Ÿæ€§èƒ½ | 
| **åŠŸèƒ½å®Œæ•´æ€§** | ğŸŸ¢ 100% å…¼å®¹ | ğŸ”´ åŠŸèƒ½å—é™ |  
| **ç”¨æˆ·ä½“éªŒ** | ğŸ”´ å®‰è£…æç«¯å¤æ‚ | ğŸŸ¢ åŸç”Ÿä½“éªŒ | 
| **ç»´æŠ¤æˆæœ¬** | ğŸŸ¢ ä½ç»´æŠ¤ | ğŸ”´ åŒé‡ç»´æŠ¤ |  



### è¿›ä¸€æ­¥åœºæ™¯åˆ†æ

é™¤éå¼€å‘è€…æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œæ¯”å¦‚éœ€è¦ agent æ¥æ“ä½œç§»åŠ¨ç«¯ç‹¬å çš„æŸäº› appï¼ˆæ·˜å®ã€å¾®ä¿¡ç­‰ï¼‰ï¼Œä½†è¿™ä¸ªå¸‚åœºç›¸å¯¹è¾ƒå°ï¼Œè€Œä¸”å®¹æ˜“åç¦»æ ¸å¿ƒæ–¹å‘ã€‚

è®¤çœŸæ¥åšçš„è¯ï¼Œç§»åŠ¨ç«¯æ–¹æ¡ˆè¿˜æ˜¯æŒºè´¹èµ„æºçš„ã€‚æŠ€æœ¯å¤æ‚åº¦é«˜ï¼ŒæŠ•å…¥äº§å‡ºæ¯”ä¸å¤ªç†æƒ³ã€‚

ä½†åé¢å¯ä»¥å°è¯•ç›´æ¥æ‰“åŒ…åˆ°å®¹å™¨ï¼Œä¸åšæ“ä½œç”¨æˆ·æ‰‹æœºçš„æ“ä½œï¼Œå•çº¯å»è·‘ä¸€äº›ä¿¡æ¯æŠ“å–ã€æ–‡æ¡£å¤„ç†ä¹‹ç±»çš„ flowï¼Œè¿˜æ˜¯å¯è¡Œçš„ã€‚

### æ–¹æ¡ˆä¸‰ï¼šå®¹å™¨åŒ–éƒ¨ç½²

```
Container-based MoFA Mobile Stage
â”œâ”€â”€ Docker/Podman å®¹å™¨
â”‚   â”œâ”€â”€ å®Œæ•´ MoFA ç¯å¢ƒ
â”‚   â”œâ”€â”€ é¢„è£…å¸¸ç”¨ä¾èµ–
â”‚   â””â”€â”€ æ ‡å‡†åŒ–è¿è¡Œæ—¶
â”œâ”€â”€ å¸¸ç”¨Agent/Flow
â”‚   â”œâ”€â”€ ç½‘é¡µæ•°æ®æŠ“å–
â”‚   â”œâ”€â”€ æ–‡æ¡£å¤„ç† Flow
â”‚   â”œâ”€â”€ API è°ƒç”¨é›†æˆ
â”‚   â””â”€â”€ æ•°æ®åˆ†æä»»åŠ¡
â””â”€â”€ ç§»åŠ¨ç«¯é€‚é…
    â”œâ”€â”€ å“åº”å¼ Web UI
    â”œâ”€â”€ è§¦æ‘¸ä¼˜åŒ–äº¤äº’
    â””â”€â”€ ç¦»çº¿ç¼“å­˜æ”¯æŒ
```

å¥½å¤„ï¼š
- æŠ€æœ¯æ ˆå®Œå…¨å¤ç”¨ï¼Œä¸ç”¨é‡æ–°é€ è½®å­
- éƒ¨ç½²ç®€å•

### æ–¹æ¡ˆå››ï¼šäº‘ç«¯ + ç½‘é¡µå¥—å£³ App

åæœŸåœ¨äº‘ç«¯éƒ¨ç½²åï¼Œåšä¸€ä¸ªç½‘é¡µå¥—å£³ MoFA Stage çš„ appã€‚

```
Cloud MoFA + Mobile Client
â”œâ”€â”€ äº‘ç«¯ MoFA 
â”‚   â”œâ”€â”€ æ™ºèƒ½ä½“è¿è¡Œç¯å¢ƒ
â”‚   â”œâ”€â”€ ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ
â”‚   â””â”€â”€ ç»“æœç¼“å­˜å±‚
â”œâ”€â”€ ç§»åŠ¨ç«¯ App (ç½‘é¡µå¥—å£³)
â”‚   â”œâ”€â”€ MoFA Stage ç§»åŠ¨ç‰ˆ
â”‚   â”œâ”€â”€ ä»»åŠ¡åˆ›å»ºä¸ç›‘æ§
â”‚   â”œâ”€â”€ ç»“æœå±•ç¤ºç•Œé¢
â”‚   â””â”€â”€ ç¦»çº¿æ¨¡å¼æ”¯æŒ
â””â”€â”€ é€šä¿¡å±‚
    â”œâ”€â”€ WebSocket å®æ—¶é€šä¿¡
    â”œâ”€â”€ RESTful API
    â””â”€â”€ æ¶ˆæ¯é˜Ÿåˆ—åŒæ­¥
```


å¥½å¤„ï¼š
- ä¸ç”¨é€ è½®å­
- æŠ€æœ¯æ ˆä¿æŒä¸€è‡´ï¼Œç»´æŠ¤ç®€å•
- è§£å†³ç”¨æˆ·çš„å®é™…éœ€æ±‚ï¼Œä¸æ˜¯ä¸ºäº†ç§»åŠ¨ç«¯è€Œç§»åŠ¨ç«¯

---
