---
// å·¥ä½œæµé…ç½®æ•°æ®
const workflows = [
  {
    id: 'hello-world',
    title: {
      en: 'Hello World',
      zh: 'Hello World'
    },
    description: {
      en: 'Basic agent example',
      zh: 'æœ€ç®€å•çš„ AI ä»£ç†æ•°æ®æµ'
    },
    category: 'Basic',
    color: 'mofa-color-1',
    scale: 0.3,
    mermaidGraph: `
    flowchart TB
      terminal-input[ğŸ–¥ï¸ Terminal Input<br/>User Query]
      agent[ğŸ¤– Agent<br/>Process & Respond]
      
      terminal-input --> agent
      agent --> terminal-input
      
      classDef inputNode fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
      classDef agentNode fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
      
      class terminal-input inputNode
      class agent agentNode`
  },
  {
    id: 'arxiv-research',
    title: {
      en: 'ArXiv Research',
      zh: 'ArXiv ç ”ç©¶'
    },
    description: {
      en: 'Automated paper research',
      zh: 'è‡ªåŠ¨åŒ–ç ”ç©¶ï¼ŒåŒ…å«è®ºæ–‡åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆ'
    },
    category: 'Research',
    color: 'mofa-color-2',
    scale: 1.0,
    mermaidGraph: `
    flowchart TB
      terminal[ğŸ–¥ï¸ Terminal Input<br/>Research Task]
      extractor[ğŸ” Keyword Extractor<br/>Extract Keywords]
      downloader[ğŸ“¥ Paper Downloader<br/>Download Papers]
      analyzer[ğŸ”¬ Paper Analyzer<br/>Analyze Content]
      writer[âœï¸ Report Writer<br/>Generate Report]
      feedback[ğŸ’¬ Feedback Agent<br/>Review & Suggest]
      refinement[ğŸ”§ Refinement Agent<br/>Improve Report]
      
      terminal --> extractor
      extractor --> downloader
      downloader --> analyzer
      terminal --> analyzer
      analyzer --> writer
      terminal --> writer
      writer --> feedback
      terminal --> feedback
      feedback --> refinement
      terminal --> refinement
      
      classDef inputNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
      classDef processNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px
      classDef analysisNode fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
      classDef outputNode fill:#fce4ec,stroke:#c2185b,stroke-width:2px
      
      class terminal inputNode
      class extractor,downloader processNode
      class analyzer,feedback analysisNode
      class writer,refinement outputNode`
  },
  {
    id: 'rag-system',
    title: {
      en: 'RAG System',
      zh: 'RAG ç³»ç»Ÿ'
    },
    description: {
      en: 'RAG for Q&A',
      zh: 'æ£€ç´¢å¢å¼ºç”Ÿæˆç³»ç»Ÿï¼Œç”¨äºæ™ºèƒ½é—®ç­”'
    },
    category: 'AI',
    color: 'mofa-color-3',
    scale: 0.5,
    mermaidGraph: `
    flowchart TB
      terminal[ğŸ–¥ï¸ Terminal Input<br/>User Question]
      retrieval[ğŸ” RAG Retrieval<br/>Search Knowledge]
      reasoner[ğŸ§  Reasoner Agent<br/>Generate Answer]
      
      terminal --> retrieval
      retrieval --> reasoner
      terminal --> reasoner
      retrieval --> terminal
      reasoner --> terminal
      
      classDef inputNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
      classDef retrievalNode fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
      classDef reasoningNode fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
      
      class terminal inputNode
      class retrieval retrievalNode
      class reasoner reasoningNode`
  },
  {
    id: 'gosim-pedia',
    title: {
      en: 'GoSim Pedia',
      zh: 'GoSim ç™¾ç§‘'
    },
    description: {
      en: 'Multi-agent web research',
      zh: 'å…·æœ‰ç½‘é¡µæŠ“å–å’Œæœç´¢èƒ½åŠ›çš„å¤šä»£ç†ç³»ç»Ÿ'
    },
    category: 'Web',
    color: 'mofa-color-4',
    scale: 0.9,
    mermaidGraph: `
    flowchart TB
      openai[ğŸ¤– OpenAI Server<br/>Chat Interface]
      gosim[ğŸ® GoSim Pedia Agent<br/>Main Controller]
      firecrawl[ğŸ•·ï¸ Firecrawl Agent<br/>Web Scraping]
      rag[ğŸ§  GoSim RAG Agent<br/>Knowledge Retrieval]
      serper[ğŸ” Serper Search Agent<br/>Web Search]
      
      openai <--> gosim
      gosim --> firecrawl
      firecrawl --> gosim
      gosim --> rag
      rag --> gosim
      gosim --> serper
      serper --> gosim
      
      classDef serverNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
      classDef mainNode fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
      classDef toolNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px
      
      class openai serverNode
      class gosim mainNode
      class firecrawl,rag,serper toolNode`
  },
  {
    id: 'mem0-dataflow',
    title: {
      en: 'Mem0 Memory System',
      zh: 'Mem0 è®°å¿†ç³»ç»Ÿ'
    },
    description: {
      en: 'Memory-enhanced dataflow',
      zh: 'å…·æœ‰è®°å¿†æ£€ç´¢å’Œè®°å½•èƒ½åŠ›çš„å¢å¼ºAIæ•°æ®æµ'
    },
    category: 'Memory',
    color: 'mofa-color-1',
    scale: 0.75,
    mermaidGraph: `
    flowchart TB
      terminal[ğŸ–¥ï¸ Terminal Input<br/>User Task]
      retrieval[ğŸ§  Memory Retrieval<br/>Fetch Context]
      reasoner[ğŸ¤” Reasoner<br/>Process & Think]
      record[ğŸ’¾ Memory Record<br/>Store Results]
      
      terminal --> retrieval
      retrieval --> reasoner
      terminal --> reasoner
      reasoner --> record
      terminal --> record
      retrieval --> terminal
      reasoner --> terminal
      record --> terminal
      
      classDef inputNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
      classDef memoryNode fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
      classDef processNode fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
      classDef storageNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px
      
      class terminal inputNode
      class retrieval memoryNode
      class reasoner processNode
      class record storageNode`
  },
  {
    id: 'intelligent-agent-creation',
    title: {
      en: 'Agent Creation System',
      zh: 'ä»£ç†åˆ›å»ºç³»ç»Ÿ'
    },
    description: {
      en: 'Auto-generate AI agents',
      zh: 'è‡ªåŠ¨ç”ŸæˆAIä»£ç†çš„æ™ºèƒ½ç³»ç»Ÿ'
    },
    category: 'Meta-AI',
    color: 'mofa-color-2',
    scale: 0.75,
    mermaidGraph: `
    flowchart TB
      openai[ğŸ¤– OpenAI Server<br/>API Interface]
      config[âš™ï¸ Config Generator<br/>Generate Settings]
      code[ğŸ‘¨â€ğŸ’» Code Generator<br/>Write Agent Code]
      dependency[ğŸ“¦ Dependency Generator<br/>Manage Dependencies]
      
      openai --> config
      openai --> code
      config --> code
      openai --> dependency
      code --> dependency
      config --> dependency
      dependency --> openai
      
      classDef serverNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
      classDef generatorNode fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
      classDef codeNode fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
      classDef depNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px
      
      class openai serverNode
      class config generatorNode
      class code codeNode
      class dependency depNode`
  },
  {
    id: 'xiaowang-workflow',
    title: {
      en: 'XiaoWang Multi-Agent',
      zh: 'å¤šä»£ç†ç³»ç»Ÿ'
    },
    description: {
      en: 'Multi-agent reflection & generation',
      zh: 'å…·æœ‰åæ€å’Œç”Ÿæˆèƒ½åŠ›çš„å¤æ‚å¤šä»£ç†æ•°æ®æµ'
    },
    category: 'Complex',
    color: 'mofa-color-3',
    scale: 0.75,
    mermaidGraph: `
    flowchart TB
      terminal[ğŸ–¥ï¸ XiaoWang Terminal<br/>Task Input]
      dlc[ğŸ¯ Agent DLC<br/>Task Processing]
      generate[ğŸ”§ Agent Generate<br/>Content Creation]
      reflection[ğŸ¤” Agent Reflection<br/>Self-Improvement]
      
      terminal --> dlc
      dlc --> generate
      generate --> reflection
      reflection --> generate
      generate --> dlc
      dlc --> terminal
      generate --> terminal
      reflection --> terminal
      
      classDef inputNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
      classDef taskNode fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
      classDef generateNode fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
      classDef reflectNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px
      
      class terminal inputNode
      class dlc taskNode
      class generate generateNode
      class reflection reflectNode`
  }
];

const repoLinks = {
  'hello-world': 'https://github.com/mofa-org/mofa/tree/main/python/examples/hello_world',
  'arxiv-research': 'https://github.com/mofa-org/mofa/tree/main/python/examples/arxiv_research',
  'rag-system': 'https://github.com/mofa-org/mofa/tree/main/python/examples/rag',
  'gosim-pedia': 'https://github.com/mofa-org/mofa/tree/main/python/examples/gosim-pedia',
  'mem0-dataflow': 'https://github.com/mofa-org/mofa/tree/main/python/examples/mem0-dataflow',
  'intelligent-agent-creation': 'https://github.com/mofa-org/mofa/tree/main/python/examples/intelligent_agent_creation',
  'xiaowang-workflow': 'https://github.com/mofa-org/mofa/tree/main/python/examples/xiaowang'
};
---

<section class="py-20" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);">
  <div class="container mx-auto px-4">
    <div class="text-center mb-16">
      <h2 class="text-4xl font-bold mb-4" 
          data-en="Real Examples: <span class='gradient-text'>AI Dataflows</span> in Action"
          data-zh="å®é™…æ¡ˆä¾‹ï¼š<span class='gradient-text'>AI æ•°æ®æµ</span>å®æˆ˜">
        Real Examples: <span class="gradient-text">AI Dataflows</span> in Action
      </h2>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto" 
         data-en="Explore different types of AI dataflows - from simple hello world to complex research automation"
         data-zh="æ¢ç´¢ä¸åŒç±»å‹çš„ AI æ•°æ®æµ - ä»ç®€å•çš„Hello Worldåˆ°å¤æ‚çš„ç ”ç©¶è‡ªåŠ¨åŒ–">
        Explore different types of AI dataflows - from simple hello world to complex research automation
      </p>
    </div>

    <!-- Workflow Horizontal Scroll Container -->
    <div class="workflow-container">
      <div class="workflow-scroll">
        {workflows.map((workflow) => (
          <div class="workflow-card bg-white rounded-lg shadow-lg border-4 border-gray-300 hover:border-4 hover:border-indigo-500 transition-all duration-300 overflow-hidden">
            <!-- Header -->
            <div class={`${workflow.color} p-6 text-white`}>
              <h3 class="text-2xl font-bold mb-2" 
                  data-en={workflow.title.en}
                  data-zh={workflow.title.zh}>
                {workflow.title.en}
              </h3>
              <p class="text-white text-opacity-90" 
                 data-en={workflow.description.en}
                 data-zh={workflow.description.zh}>
                {workflow.description.en}
              </p>
            </div>

            <!-- Mermaid Graph -->
            <div class="chart-container">
              <div class={`mermaid-container-${workflow.id} bg-gray-50 rounded-lg p-4 border-2 border-gray-200`} data-scale={workflow.scale}>
                <div class={`mermaid mermaid-${workflow.id}`}>
                  {workflow.mermaidGraph}
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="p-4 flex justify-end gap-2">
              <!-- Zoom / View Button -->
              <button type="button" class={`workflow-view-btn ${workflow.color}`} data-target-id={workflow.id}
                      aria-label="View Diagram"
                      data-en="View" data-zh="æŸ¥çœ‹">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-2 w-2" fill="currentColor" viewBox="0 0 24 24"><path d="M10 2a8 8 0 1 0 4.906 14.32l4.387 4.387a1 1 0 0 0 1.414-1.414l-4.387-4.387A8 8 0 0 0 10 2zm0 2a6 6 0 1 1 0 12A6 6 0 0 1 10 4z"/></svg>
                <span class="ml-1 hidden sm:inline">View</span>
              </button>

              <!-- GitHub Link Button -->
              <a href={repoLinks[workflow.id]} target="_blank" rel="noopener noreferrer"
                 class={`workflow-code-btn ${workflow.color}`}
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-2 w-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 .5C5.73.5.49 5.74.49 12.02c0 5.11 3.29 9.44 7.86 10.97.58.11.79-.25.79-.56 0-.28-.01-1.02-.02-2-3.2.7-3.88-1.55-3.88-1.55-.53-1.33-1.3-1.68-1.3-1.68-1.06-.72.08-.71.08-.71 1.17.08 1.79 1.2 1.79 1.2 1.04 1.78 2.73 1.27 3.4.97.11-.75.41-1.27.75-1.56-2.56-.29-5.26-1.28-5.26-5.7 0-1.26.46-2.29 1.2-3.1-.12-.29-.52-1.45.11-3.02 0 0 .97-.31 3.18 1.19a11.1 11.1 0 0 1 2.9-.39c.98.01 1.97.13 2.9.39 2.21-1.5 3.17-1.19 3.17-1.19.63 1.57.23 2.73.11 3.02.75.81 1.2 1.84 1.2 3.1 0 4.43-2.71 5.41-5.29 5.69.42.36.8 1.09.8 2.2 0 1.59-.02 2.87-.02 3.26 0 .31.2.68.8.56a10.53 10.53 0 0 0 7.85-10.97C23.51 5.74 18.27.5 12 .5z"/></svg>
                <span class="ml-1" data-en="Code" data-zh="ä»£ç ">Code</span>
              </a>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Scroll hint -->
    <div class="text-center mt-8">
      <p class="text-sm text-gray-500" 
         data-en="â† Scroll horizontally to explore more workflows â†’"
         data-zh="â† æ°´å¹³æ»šåŠ¨ä»¥æ¢ç´¢æ›´å¤šæ•°æ®æµ â†’">
        â† Scroll horizontally to explore more workflows â†’
      </p>
    </div>
  </div>
</section>

<!-- Mermaid Script -->
<script>
  // Import and initialize Mermaid
  import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs').then((mermaid) => {
    mermaid.default.initialize({
      startOnLoad: true,
      theme: 'base',
      themeVariables: {
        primaryColor: '#6366F1',
        primaryTextColor: '#1F2937',
        primaryBorderColor: '#6366F1',
        lineColor: '#0EA5E9',
        sectionBkgColor: '#F8FAFC',
        altSectionBkgColor: '#FFFFFF',
        gridColor: '#E5E7EB',
        secondaryColor: '#F59E0B',
        tertiaryColor: '#F59E0B'
      },
      fontFamily: 'Inter, system-ui, -apple-system, sans-serif',
      fontSize: 20,
      flowchart: {
        htmlLabels: true,
        curve: 'basis',
        useMaxWidth: true,
        rankdir: 'TB',
        padding: 20
      },
      security: {
        level: 'loose'
      },
      maxTextSize: 90000,
      maxEdges: 500
    });

    // Render all mermaid diagrams
    setTimeout(() => {
      mermaid.default.run();
      
      // è‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°ä»¥é€‚åº”å®¹å™¨
      setTimeout(() => {
        document.querySelectorAll('.mermaid').forEach(element => {
          const svg = element.querySelector('svg');
          const container = element.closest('[data-scale]');
          const scale = container ? parseFloat(container.getAttribute('data-scale')) : 1;
          
          if (svg) {
            // ç§»é™¤å›ºå®šçš„å®½é«˜ï¼Œä½¿ç”¨viewBoxè¿›è¡Œç¼©æ”¾
            svg.removeAttribute('height');
            svg.removeAttribute('width');
            svg.style.maxWidth = '100%';
            svg.style.maxHeight = '100%';
            
            // ç¡®ä¿viewBoxå­˜åœ¨å¹¶è®¾ç½®preserveAspectRatio
            if (!svg.getAttribute('viewBox')) {
              const bbox = svg.getBBox();
              svg.setAttribute('viewBox', `0 0 ${bbox.width + 20} ${bbox.height + 20}`);
            }
            svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
            
            // åº”ç”¨ä¸ªåˆ«ç¼©æ”¾
            svg.style.width = `${scale * 100}%`;
            svg.style.height = `${scale * 100}%`;
            svg.style.transform = 'none';
          }
        });
        
        // åˆå§‹åŒ–è‡ªåŠ¨æ»šåŠ¨
        initAutoScroll();
        // åˆå§‹åŒ–ç‚¹å‡»æ”¾å¤§ç”»å»Šæ¨¡å¼
        setupGallery();
      }, 500);
    }, 100);
  }).catch(error => {
    console.error('Failed to load Mermaid:', error);
  });

  // è‡ªåŠ¨æ»šåŠ¨åŠŸèƒ½ï¼ˆæ— é™å¾ªç¯ï¼‰
  function initAutoScroll() {
    const scrollContainer = document.querySelector('.workflow-scroll');
    if (!scrollContainer) return;

    const scrollSpeed = 0.5; // è°ƒæ…¢æ»šåŠ¨é€Ÿåº¦ (px per frame)
    let animationId = null;
    let isPaused = false;
    let isUserInteracting = false;
    let interactTimeout = null;

    // å¤åˆ¶å†…å®¹ä¸¤æ¬¡ï¼ˆå‰åå„ä¸€ä»½ï¼‰ï¼Œå½¢æˆé¦–å°¾è¡”æ¥
    const originalCards = Array.from(scrollContainer.children);
    originalCards.forEach(card => {
      scrollContainer.appendChild(card.cloneNode(true));
      scrollContainer.insertBefore(card.cloneNode(true), scrollContainer.firstChild);
    });

    // åˆå§‹åŒ–æ»šåŠ¨ä½ç½®åˆ°çœŸæ­£å†…å®¹çš„ç¬¬ä¸€ä»½ï¼ˆä¸­é—´åŒºåŸŸï¼‰
    requestAnimationFrame(() => {
      const halfWidth = scrollContainer.scrollWidth / 3; // ä¸‰ä»½ä¸­çš„ç¬¬äºŒä»½èµ·ç‚¹
      scrollContainer.scrollLeft = halfWidth;
    });

    function loopBoundaryCheck() {
      const thirdWidth = scrollContainer.scrollWidth / 3;
      if (scrollContainer.scrollLeft <= thirdWidth * 0.2) {
        // é è¿‘æœ€å·¦ä¾§ï¼ˆç¬¬ä¸€ä»½æœ«å°¾ï¼‰â†’ è·³åˆ°ä¸­é—´
        scrollContainer.scrollLeft += thirdWidth;
      } else if (scrollContainer.scrollLeft >= thirdWidth * 1.8) {
        // é è¿‘æœ€å³ä¾§ï¼ˆç¬¬ä¸‰ä»½å¼€å§‹ï¼‰â†’ è·³å›ä¸­é—´
        scrollContainer.scrollLeft -= thirdWidth;
      }
    }

    function autoScroll() {
      if (!isPaused && !isUserInteracting && scrollContainer) {
        scrollContainer.scrollLeft += scrollSpeed;
        loopBoundaryCheck();
      }
      animationId = requestAnimationFrame(autoScroll);
    }

    // ç”¨æˆ·äº¤äº’æ£€æµ‹
    function onUserInteract() {
      isUserInteracting = true;
      if (interactTimeout) clearTimeout(interactTimeout);
      interactTimeout = setTimeout(() => {
        isUserInteracting = false;
      }, 2000);
    }

    ['wheel', 'touchstart', 'touchmove', 'mousedown', 'mouseup'].forEach(evt => {
      scrollContainer.addEventListener(evt, onUserInteract, { passive: true });
    });

    // é¼ æ ‡æ‚¬æµ®æš‚åœ
    scrollContainer.addEventListener('mouseenter', () => { isPaused = true; });
    scrollContainer.addEventListener('mouseleave', () => { isPaused = false; });

    // æ»šåŠ¨äº‹ä»¶æœ¬èº«ä¹Ÿç”¨äºè¾¹ç•Œæ£€æµ‹
    scrollContainer.addEventListener('scroll', loopBoundaryCheck);

    autoScroll();

    window.addEventListener('beforeunload', () => {
      if (animationId) cancelAnimationFrame(animationId);
      if (interactTimeout) clearTimeout(interactTimeout);
    });
  }

  // ç”»å»Šæ¨¡å¼ï¼šç‚¹å‡»å¡ç‰‡æ”¾å¤§æŸ¥çœ‹ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰
  function setupGallery() {
    // è®¾ç½®æ‰€æœ‰å¡ç‰‡cursoræ ·å¼ï¼ˆåˆæ¬¡è¿è¡Œ & åç»­å…‹éš†çš„ï¼‰
    document.querySelectorAll('.workflow-card').forEach(c => {
      c.style.cursor = 'zoom-in';
    });

    // ä½¿ç”¨ document çº§äº‹ä»¶å§”æ‰˜ï¼Œä¿è¯ä»»ä½•æ—¶é—´åŠ¨æ€æ’å…¥çš„å¡ç‰‡éƒ½æœ‰æ•ˆ
    document.addEventListener('click', (e) => {
      const card = e.target.closest('.workflow-card');
      if (!card) return;
      let contentEl = card.querySelector('.mermaid svg') || card.querySelector('.mermaid');
      if (!contentEl) return;
      console.debug('[Gallery] Card clicked, opening modal');
      openModal(contentEl);
    }, true); // capture é˜¶æ®µï¼Œé¿å…å†…éƒ¨é˜»æ­¢
  }

  function openModal(element) {
    if (!element) return;

    // Collect all workflow diagrams (svg or mermaid container) for navigation
    const allDiagrams = Array.from(document.querySelectorAll('[class^="mermaid-container-"] svg, [class^="mermaid-container-"] .mermaid')).filter(Boolean);
    if (!allDiagrams.includes(element)) allDiagrams.push(element);
    let currentIndex = allDiagrams.findIndex(el => el === element);
    if (currentIndex === -1) currentIndex = 0;

    // Remove existing modal if any
    const existing = document.querySelector('.workflow-modal');
    if (existing) existing.remove();

    // Create modal overlay
    const modal = document.createElement('div');
    modal.className = 'workflow-modal';
    modal.style.cssText = 'position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);padding:2rem;';

    // Modal inner HTML with nav & zoom controls
    modal.innerHTML = `
      <button class="gallery-nav gallery-prev" aria-label="Prev">&#9664;</button>
      <button class="gallery-nav gallery-next" aria-label="Next">&#9654;</button>
      <div class="workflow-modal-content" style="position:relative;width:90vw;height:90vh;overflow:hidden;background:#FFF3D9;border-radius:8px;border:4px solid var(--mondrian-black);box-shadow:6px 6px 0 var(--mondrian-black);display:flex;flex-direction:column;">
        <button class="workflow-modal-close" aria-label="Close" style="position:absolute;top:0.25rem;right:0.5rem;font-size:1.5rem;background:transparent;border:none;color:#333;cursor:pointer;">&times;</button>
        <div class="workflow-modal-body" style="padding:1rem;display:flex;align-items:center;justify-content:center;flex:1;overflow:auto;"></div>
        <div class="gallery-zoom" style="position:absolute;bottom:0.5rem;right:0.75rem;display:flex;gap:0.5rem;">
          <button class="zoom-in" aria-label="Zoom in" style="font-size:1.25rem;width:2rem;height:2rem;border:none;border-radius:4px;background:#e5e7eb;cursor:pointer;">+</button>
          <button class="zoom-out" aria-label="Zoom out" style="font-size:1.25rem;width:2rem;height:2rem;border:none;border-radius:4px;background:#e5e7eb;cursor:pointer;">&minus;</button>
        </div>
      </div>`;

    document.body.appendChild(modal);

    const body = modal.querySelector('.workflow-modal-body');
    let zoom = 1;

    function render() {
      body.innerHTML = '';
      const src = allDiagrams[currentIndex];
      if (!src) return;
      let clone = src.cloneNode(true);
      if (clone.tagName.toLowerCase() === 'svg') {
        clone.removeAttribute('width');
        clone.removeAttribute('height');
        clone.style.width = '100%';
        clone.style.height = 'auto';
        clone.style.maxWidth = '100%';
        clone.style.maxHeight = '100%';
      }
      clone.style.transformOrigin = 'center center';
      clone.style.transform = `scale(${zoom})`;
      body.appendChild(clone);
    }

    function changeIndex(delta) {
      currentIndex = (currentIndex + delta + allDiagrams.length) % allDiagrams.length;
      zoom = 1;
      render();
    }

    // initial render
    render();

    // Event listeners
    modal.querySelector('.gallery-prev').addEventListener('click', () => changeIndex(-1));
    modal.querySelector('.gallery-next').addEventListener('click', () => changeIndex(1));
    modal.querySelector('.zoom-in').addEventListener('click', () => { zoom = Math.min(zoom + 0.2, 4); render(); });
    modal.querySelector('.zoom-out').addEventListener('click', () => { zoom = Math.max(zoom - 0.2, 0.4); render(); });

    const prevOverflow = document.body.style.overflow;
    document.body.style.overflow = 'hidden';

    const close = () => {
      modal.remove();
      document.body.style.overflow = prevOverflow;
      document.removeEventListener('keydown', escHandler);
      document.removeEventListener('keydown', navHandler);
    };

    modal.querySelector('.workflow-modal-close').addEventListener('click', close);
    modal.addEventListener('click', (ev) => { if (ev.target === modal) close(); });

    const escHandler = (ev) => { if (ev.key === 'Escape') close(); };
    document.addEventListener('keydown', escHandler);

    const navHandler = (ev) => {
      if (ev.key === 'ArrowLeft') changeIndex(-1);
      else if (ev.key === 'ArrowRight') changeIndex(1);
      else if (ev.key === '+') { zoom = Math.min(zoom + 0.2, 4); render(); }
      else if (ev.key === '-') { zoom = Math.max(zoom - 0.2, 0.4); render(); }
    };
    document.addEventListener('keydown', navHandler);
  }

  // Delegate click for newly added view buttons (supports cloned cards as well)
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.workflow-view-btn');
    if (!btn) return;
    e.stopPropagation();
    const id = btn.getAttribute('data-target-id');
    const container = document.querySelector(`.mermaid-container-${id} svg`) ||
                      document.querySelector(`.mermaid-container-${id} .mermaid`);
    if (container) {
      console.log('[ViewBtn] opening modal for', id);
      window.openWorkflowModal(container);
    }
  }, true);

  // Set cursor style for any current & future cards via mutation observer
  const setCursor = () => document.querySelectorAll('.workflow-card').forEach(c=>c.style.cursor='zoom-in');
  setCursor();
  new MutationObserver(setCursor).observe(document.querySelector('.workflow-scroll'), {childList:true});

  window.openWorkflowModal = openModal;
</script>

<style>
/* MoFA å“ç‰Œé¢œè‰²å®šä¹‰ */
.mofa-color-1 {
  background: linear-gradient(135deg, #FC6A59, #E55A4A);
}

.mofa-color-2 {
  background: linear-gradient(135deg, #FFC53D, #E6B034);
}

.mofa-color-3 {
  background: linear-gradient(135deg, #FD543F, #E64936);
}

.mofa-color-4 {
  background: linear-gradient(135deg, #6CCBCD, #5BB7B9);
}

.workflow-container {
  position: relative;
  max-width: 100vw;
  overflow: hidden;
  margin: 0 auto;
}

.workflow-scroll {
  display: flex;
  gap: 1.5rem;
  overflow-x: auto; /* æ¢å¤æ‰‹åŠ¨æ»šåŠ¨åŠŸèƒ½ */
  padding: 1rem 0;
  scroll-behavior: auto; /* æ”¹å›autoï¼Œé¿å…ä¸JSå†²çª */
  white-space: nowrap;
  scrollbar-width: none;
  scrollbar-color: #cbd5e1 #f1f5f9;
}

.workflow-scroll::-webkit-scrollbar {
  display: none;
}

.workflow-scroll::-webkit-scrollbar-track {
  background: #f1f5f9;
  border-radius: 3px;
}

.workflow-scroll::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 3px;
}

.workflow-scroll::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}

.workflow-card {
  flex: 0 0 auto;
  width: 380px; /* ä»450pxè¿›ä¸€æ­¥ç¼©å°åˆ°380px */
  height: 520px; /* ä»600pxè¿›ä¸€æ­¥ç¼©å°åˆ°520px */
  transform: translateY(0);
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  border: 3px solid var(--mondrian-black);
}

.workflow-card:hover {
  transform: translateY(-4px) scale(1.02); /* æ·»åŠ è½»å¾®æ”¾å¤§æ•ˆæœ */
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  z-index: 10;
  box-shadow: 4px 4px 0 var(--mondrian-black);
  transform: translate(-2px,-2px) scale(1.02);
}

.chart-container {
  flex: 1;
  padding: 1rem; /* ä»1.5remè°ƒæ•´ä¸º1rem */
  display: flex;
  flex-direction: column;
  min-height: 0;
  position: relative;
  overflow: hidden;
}

.chart-container > div {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 0;
  position: relative;
  overflow: hidden;
}

.mermaid {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 250px; /* ä»300pxè¿›ä¸€æ­¥ç¼©å°åˆ°250px */
  font-size: 18px; /* ä»20pxè¿›ä¸€æ­¥ç¼©å°åˆ°18px */
}

.mermaid svg {
  max-width: 100% !important;
  max-height: 100% !important;
  width: auto !important;
  height: auto !important;
}

/* Custom mermaid styling */
.mermaid .node rect,
.mermaid .node circle,
.mermaid .node ellipse,
.mermaid .node polygon {
  stroke-width: 2px;
}

.mermaid .node text {
  font-size: 16px !important; /* ä»18pxè¿›ä¸€æ­¥ç¼©å°åˆ°16px */
  font-weight: 600 !important;
  font-family: 'Inter', system-ui, sans-serif !important;
}

.mermaid .edgePath path {
  stroke-width: 2px;
}

.mermaid .edgeLabel {
  background-color: white;
  border-radius: 6px;
  padding: 3px 6px; /* ä»4px 8pxè¿›ä¸€æ­¥ç¼©å°åˆ°3px 6px */
  font-size: 14px; /* ä»16pxè¿›ä¸€æ­¥ç¼©å°åˆ°14px */
  font-weight: 500;
  font-family: 'Inter', system-ui, sans-serif;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* å·¥ä½œæµå¡ç‰‡å¤´éƒ¨è°ƒæ•´ */
.workflow-card .mofa-color-1,
.workflow-card .mofa-color-2,
.workflow-card .mofa-color-3,
.workflow-card .mofa-color-4 {
  padding: 1rem 1.5rem; /* ä»1.5remè°ƒæ•´ä¸º1rem 1.5rem */
}

.workflow-card h3 {
  font-size: 1.5rem; /* ä»2xlè°ƒæ•´ä¸º1.5rem */
  margin-bottom: 0.5rem; /* ä»0.75remè°ƒæ•´ä¸º0.5rem */
}

.workflow-card p {
  font-size: 0.875rem; /* è°ƒæ•´æè¿°æ–‡å­—å¤§å° */
  line-height: 1.4;
}

/* ç¦ç”¨Mermaidå®¹å™¨ä¸­çš„mondrian-blockåŠ¨ç”»æ•ˆæœ */
.mermaid-container-hello-world::after,
.mermaid-container-arxiv-research::after,
.mermaid-container-rag-system::after,
.mermaid-container-gosim-pedia::after,
.mermaid-container-mem0-dataflow::after,
.mermaid-container-intelligent-agent-creation::after,
.mermaid-container-xiaowang-workflow::after,
.chart-container::after,
.chart-container > div::after {
  display: none !important;
}

.workflow-card *::after,
.workflow-card *::before,
.workflow-card::after,
.workflow-card::before {
  animation: none !important;
  display: none !important;
}

/* ç¡®ä¿Mermaidå®¹å™¨ä¸å—å…¨å±€mondrianæ ·å¼å½±å“ */
.mermaid,
.mermaid *,
.chart-container,
.chart-container * {
  position: relative;
}

.mermaid::after,
.mermaid::before,
.mermaid *::after,
.mermaid *::before {
  display: none !important;
}

/* éšè—å¯èƒ½çš„æ©™è‰²æ ‡è®°å…ƒç´  */
.workflow-card [style*="orange"],
.workflow-card [style*="#FFA500"],
.workflow-card [style*="#FF6600"],
.workflow-card [style*="#F59E0B"],
.workflow-card [style*="rgb(245, 158, 11)"],
.workflow-card .bg-orange-500,
.workflow-card .text-orange-500 {
  display: none !important;
}

/* éšè—æ‰€æœ‰positionedçš„å°å…ƒç´ ï¼ˆå¯èƒ½æ˜¯æ©™è‰²ç‚¹ï¼‰ */
.workflow-card *[style*="position: absolute"][style*="width"][style*="height"] {
  display: none !important;
}

/* ä¸“é—¨é’ˆå¯¹ Mermaid edgeLabel å…ƒç´ çš„éšè—è§„åˆ™ */
.workflow-card .edgeLabels,
.workflow-card .edgeLabel,
.workflow-card g.edgeLabels,
.workflow-card g.edgeLabel,
.workflow-card .edgeLabel span,
.workflow-card .edgeLabel div,
.workflow-card .edgeLabel foreignObject {
  display: none !important;
  opacity: 0 !important;
  visibility: hidden !important;
}

/* éšè— Mermaid SVG ä¸­çš„æ‰€æœ‰ edgeLabel ç›¸å…³å…ƒç´  */
.mermaid svg .edgeLabels,
.mermaid svg .edgeLabel,
.mermaid svg g.edgeLabels,
.mermaid svg g.edgeLabel {
  display: none !important;
}

/* éšè—æ‰€æœ‰ç©ºçš„æˆ–åªåŒ…å«ç©ºç™½çš„æ ‡ç­¾å…ƒç´  */
.workflow-card span:empty,
.workflow-card div:empty,
.workflow-card .edgeLabel span:empty,
.workflow-card foreignObject[width="8"],
.workflow-card foreignObject[height="19.1953125"] {
  display: none !important;
}

/* æ›´ç²¾ç¡®åœ°éšè— Mermaid SVG ä¸­çš„ edgeLabel å…ƒç´  */
.mermaid svg g.edgeLabels,
.mermaid svg g.edgeLabel,
.mermaid svg g > g > g.edgeLabels,
.mermaid svg g > g > g.edgeLabel,
[id^="mermaid-"] g.edgeLabels,
[id^="mermaid-"] g.edgeLabel,
[id^="mermaid-"] > g > g > g.edgeLabels,
[id^="mermaid-"] > g > g > g.edgeLabel {
  display: none !important;
  opacity: 0 !important;
  visibility: hidden !important;
}

/* éšè—æ‰€æœ‰ Mermaid ç”Ÿæˆçš„ç©ºæ ‡ç­¾å’Œå°å°ºå¯¸å…ƒç´  */
.mermaid svg foreignObject[width="8"],
.mermaid svg foreignObject[height*="19"],
.mermaid svg .label foreignObject,
.mermaid svg g.label,
[id^="mermaid-"] foreignObject[width="8"],
[id^="mermaid-"] foreignObject[height*="19"],
[id^="mermaid-"] .label foreignObject,
[id^="mermaid-"] g.label {
  display: none !important;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
  .workflow-card {
    width: 300px; /* ä»350pxè¿›ä¸€æ­¥ç¼©å°åˆ°300px */
    height: 450px; /* ä»500pxè¿›ä¸€æ­¥ç¼©å°åˆ°450px */
  }
  
  .workflow-scroll {
    gap: 1rem;
  }
  
  .mermaid {
    font-size: 18px;
    min-height: 250px;
  }
  
  .mermaid .node text {
    font-size: 16px !important;
  }
  
  .mermaid .edgeLabel {
    font-size: 14px;
    padding: 3px 6px;
  }

  .chart-container {
    padding: 0.75rem;
  }
}

@media (max-width: 480px) {
  .workflow-card {
    width: 250px; /* ä»280pxè¿›ä¸€æ­¥ç¼©å°åˆ°250px */
    height: 400px; /* ä»450pxè¿›ä¸€æ­¥ç¼©å°åˆ°400px */
  }

  .mermaid {
    font-size: 14px;
    min-height: 180px;
  }
  
  .mermaid .node text {
    font-size: 14px !important;
  }
  
  .mermaid .edgeLabel {
    font-size: 12px;
    padding: 2px 4px;
  }

  .chart-container {
    padding: 0.5rem;
  }
}

.workflow-container *::after,
.workflow-container *::before {
  display: none !important;
}

/* æ›´å¼ºåŠ›çš„å…¨å±€ç¦ç”¨è§„åˆ™ - é’ˆå¯¹å·¥ä½œæµåŒºåŸŸ */
.workflow-container,
.workflow-container *,
.workflow-card,
.workflow-card *,
.chart-container,
.chart-container *,
.mermaid,
.mermaid * {
  position: relative !important;
}

.workflow-container::after,
.workflow-container::before,
.workflow-container *::after,
.workflow-container *::before,
.workflow-card::after,
.workflow-card::before,
.workflow-card *::after,
.workflow-card *::before {
  display: none !important;
  content: none !important;
  animation: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}

/* ç¦ç”¨å¯èƒ½çš„æµ®åŠ¨å…ƒç´  */
.workflow-container [style*="position: absolute"],
.workflow-card [style*="position: absolute"],
.chart-container [style*="position: absolute"] {
  display: none !important;
}

/* ä¸“é—¨é’ˆå¯¹ Mermaid edgeLabel å…ƒç´ çš„éšè—è§„åˆ™ */
.workflow-card .edgeLabels,
.workflow-card .edgeLabel,
.workflow-card g.edgeLabels,
.workflow-card g.edgeLabel,
.workflow-card .edgeLabel span,
.workflow-card .edgeLabel div,
.workflow-card .edgeLabel foreignObject {
  display: none !important;
  opacity: 0 !important;
  visibility: hidden !important;
}

/* Modal ç”»å»Šæ ·å¼ */
.workflow-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000; /* æé«˜ */
  padding: 2rem;
}

.workflow-modal-content {
  position: relative;
  width: 90vw;
  height: 90vh;
  overflow: hidden;
  background: #FFF3D9;
  border: 4px solid var(--mondrian-black);
  border-radius: 8px;
  box-shadow: 6px 6px 0 var(--mondrian-black);
  display: flex;
  flex-direction: column;
}

.workflow-modal-body {
  padding: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  flex: 1;
  overflow: auto;
}

.workflow-modal-close {
  position: absolute;
  top: 0.25rem;
  right: 0.5rem;
  font-size: 1.5rem;
  background: transparent;
  border: none;
  color: #333;
  cursor: pointer;
}

/* Code button flat style */
.workflow-code-btn {
  display: inline-flex;
  align-items: center;
  font-size: 0.55rem;
  padding: 4px 10px;
  color: #ffffff;
  text-decoration: none;
  font-weight: 700;
  border: 3px solid var(--mondrian-black);
  box-shadow: none;
  transition: 0.2s ease;
  transform: translate(0,0);
}

.workflow-code-btn:hover {
  transform: translate(-2px,-2px);
  box-shadow: 4px 4px 0 var(--mondrian-black);
}

.workflow-code-btn svg {
  flex-shrink: 0;
}

/* View button shares style with code button */
.workflow-view-btn {
  display: inline-flex;
  align-items: center;
  font-size: 0.55rem;
  padding: 4px 10px;
  color: #ffffff;
  text-decoration: none;
  font-weight: 700;
  border: 3px solid var(--mondrian-black);
  transition: 0.2s ease;
  transform: translate(0,0);
}

.workflow-view-btn:hover {
  transform: translate(-2px,-2px);
  box-shadow: 4px 4px 0 var(--mondrian-black);
}

.workflow-view-btn svg {
  flex-shrink: 0;
}

/* Gallery navigation styles */
.gallery-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 50%;
  width: 3rem;
  height: 3rem;
  font-size: 1.5rem;
  cursor: pointer;
  z-index: 10;
  transition: all 0.2s ease;
  color: #333;
  display: flex;
  align-items: center;
  justify-content: center;
}

.gallery-nav:hover {
  background: rgba(255, 255, 255, 1);
  transform: translateY(-50%) scale(1.1);
}

.gallery-prev {
  left: 1rem;
}

.gallery-next {
  right: 1rem;
}
</style> 