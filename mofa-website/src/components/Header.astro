---
// Load GitHub star count from cache file (priority) or fallback to API
import { getCollection } from 'astro:content';

let starCount = '100'; // Default fallback

try {
  const prizeEntries = await getCollection('prize');

  // Load GitHub stats from cache
  const statsCacheEntry = prizeEntries.find(entry => entry.data.type === 'repo_stats');
  if (statsCacheEntry && statsCacheEntry.data.stars !== undefined) {
    const stars = statsCacheEntry.data.stars;
    if (stars >= 1000) {
      starCount = (stars / 1000).toFixed(1).replace('.0', '') + 'K';
    } else {
      starCount = stars.toString();
    }
    console.log(`Loaded ${starCount} stars from cache (${statsCacheEntry.data.last_updated})`);
  } else {
    console.log('No GitHub stats cache found, falling back to API...');
    // Fallback to API
    const response = await fetch('https://api.github.com/repos/mofa-org/mofa', {
      headers: {
        'User-Agent': 'MoFA-Website',
        'Accept': 'application/vnd.github.v3+json'
      },
      signal: AbortSignal.timeout(5000) // 5ÁßíË∂ÖÊó∂
    });

    if (response.ok) {
      const data = await response.json();
      const stars = data.stargazers_count;

      if (typeof stars === 'number' && stars > 0) {
        // Format star count
        if (stars >= 1000) {
          starCount = (stars / 1000).toFixed(1).replace('.0', '') + 'K';
        } else {
          starCount = stars.toString();
        }
        console.log('GitHub stars fetched from API fallback:', starCount);
      }
    } else {
      console.warn('GitHub API response not ok:', response.status);
    }
  }
} catch (error) {
  console.warn('Failed to load GitHub stats:', error);
}
---

<style>
  /* Critical styles to ensure layout on initial render */
  .desktop-nav {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    margin-left: auto !important;
  }
  .nav-link {
    padding: 4px 6px !important;
    font-size: 0.9rem !important;
  }
  .btn-lang, .btn-primary {
    padding: 6px 10px !important;
    font-size: 0.85rem !important;
  }
  .nav-dropdown {
    position: relative !important;
    display: inline-flex !important;
    align-items: center !important;
  }
  .dropdown-toggle {
    display: inline-flex !important;
    align-items: center !important;
    gap: 4px !important;
    background: none !important;
    border: none !important;
    cursor: pointer;
    white-space: nowrap;
    font-weight: 500;
    color: #666;
    padding: 0;
  }

  /* ÂìçÂ∫îÂºèÊ†∑Âºè - ‰∏≠Á≠âÂ±èÂπï */
  @media (max-width: 1024px) {
    .desktop-nav {
      display: none !important;
    }
    .mobile-nav {
      display: flex !important;
    }
  }

  /* Â∞èÂ±èÂπï‰ºòÂåñ */
  @media (max-width: 400px) {
    .mobile-header {
      padding: 12px !important;
    }
    .mobile-header img {
      width: 32px !important;
      height: 32px !important;
    }
    .mobile-header .gradient-text {
      font-size: 1.2rem !important;
    }
  }
</style>
<header style="position: sticky; top: 0; background: white; border-bottom: 4px solid var(--mondrian-black); box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 50;">
  <nav class="container mobile-header" style="padding: 16px; display: flex; align-items: center; justify-content: space-between;">
    <a href="/" style="display: flex; align-items: center; gap: 8px; text-decoration: none;" rel="noopener noreferrer">
      <img src="/mofa-logo.png" alt="MoFA Logo" style="width: 40px; height: 40px; border-radius: 8px; object-fit: cover;" />
      <span class="gradient-text" style="font-size: 1.5rem; font-weight: 700;">MoFA</span>
    </a>

    <div class="desktop-nav">
      <!-- Products Dropdown -->
      <div class="nav-dropdown">
        <button class="nav-link dropdown-toggle" data-en="Products" data-zh="‰∫ßÂìÅ">
          <span>Products</span>
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6,9 12,15 18,9"></polyline>
          </svg>
        </button>
        <div class="dropdown-menu" style="position: absolute; top: 100%; left: 0; background: white; border: 2px solid var(--mondrian-black); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 200px; z-index: 1000; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.2s ease;">
          <a href="/" class="dropdown-item" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;" data-en="MoFA Framework" data-zh="MoFA Ê°ÜÊû∂">MoFA Framework</a>
          <a href="/mofa-stage" class="dropdown-item" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;" data-en="MoFA Stage" data-zh="MoFA Stage">MoFA Stage</a>
          <a href="https://mofa.fm/" class="dropdown-item" target="_blank" rel="noopener noreferrer" style="display: block; padding: 12px 16px; text-decoration: none; color: #333;" data-en="MoFA FM" data-zh="MoFA FM">MoFA FM</a>
        </div>
      </div>

      <a href="/docs" class="nav-link" data-en="Docs" data-zh="ÊñáÊ°£">Docs</a>
      <a href="/blog" class="nav-link" data-en="Blog" data-zh="ÂçöÂÆ¢">Blog</a>

      <!-- Hackathons Dropdown -->
      <div class="nav-dropdown">
        <button class="nav-link dropdown-toggle" data-en="Hackathons" data-zh="ÈªëÂÆ¢Êùæ">
          <span>Hackathons</span>
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6,9 12,15 18,9"></polyline>
          </svg>
        </button>
        <div class="dropdown-menu" style="position: absolute; top: 100%; left: 0; background: white; border: 2px solid var(--mondrian-black); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 240px; z-index: 1000; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.2s ease;">
          <a href="/#hall-of-fame" class="dropdown-item" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;" data-en="Developer Hall of Fame" data-zh="ÂºÄÂèëËÄÖÊÆøÂ†Ç">Developer Hall of Fame</a>
          <a href="/super-agent-hackathon" class="dropdown-item" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;" data-en="Super Agent Campathon 2025" data-zh="Ë∂ÖÁ∫ßÊô∫ËÉΩ‰ΩìÈªëÂÆ¢Êùæ 2025">Super Agent Campathon 2025</a>
          <a href="https://hackathon.mofa.ai" class="dropdown-item" target="_blank" rel="noopener noreferrer" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;" data-en="Code Alert Hackathon 2025" data-zh="Code Alert ÈªëÂÆ¢Êùæ 2025">Code Alert Hackathon 2025</a>
          <a href="https://gobi.upstreamlabs.org/en/" class="dropdown-item" target="_blank" rel="noopener noreferrer" style="display: block; padding: 12px 16px; text-decoration: none; color: #333;" data-en="Global Open Source Business Innovation Conference 2025" data-zh="ÂÖ®ÁêÉÂºÄÊ∫êÂïÜ‰∏öÂàõÊñ∞Â§ß‰ºö 2025">Global Open Source Business Innovation Conference 2025</a>
        </div>
      </div>

      <!-- Community Dropdown -->
      <div class="nav-dropdown">
        <button class="nav-link dropdown-toggle" data-en="Community" data-zh="Á§æÂå∫">
          <span>Community</span>
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6,9 12,15 18,9"></polyline>
          </svg>
        </button>
        <div class="dropdown-menu" style="position: absolute; top: 100%; left: 0; background: white; border: 2px solid var(--mondrian-black); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 200px; z-index: 1000; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.2s ease;">
          <a href="https://discord.gg/hKJZzDMMm9" class="dropdown-item" target="_blank" rel="noopener noreferrer" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;" data-en="Discord Community" data-zh="Discord Á§æÂå∫">Discord Community</a>
          <a href="#" id="wechat-header-link" class="dropdown-item" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #eee; cursor: pointer;" data-en="WeChat Group" data-zh="ÂæÆ‰ø°Áæ§">WeChat Group</a>
          <a href="https://github.com/mofa-org/mofa/tree/main/documents" class="dropdown-item" target="_blank" rel="noopener noreferrer" style="display: block; padding: 12px 16px; text-decoration: none; color: #333;" data-en="Contributing Guide" data-zh="Ë¥°ÁåÆÊåáÂçó">Contributing Guide</a>
        </div>
      </div>

      <button id="lang-toggle" class="btn-lang" style="gap: 6px; display: inline-flex; align-items: center; white-space: nowrap;">
        <span id="current-lang" style="display: inline;">üá∫üá∏ EN</span>
        <span style="font-size: 0.75rem; opacity: 0.8; display: inline;">‚ñº</span>
      </button>

      <a href="https://github.com/mofa-org/mofa" class="btn-primary github-star-btn" target="_blank" rel="noopener noreferrer" style="gap: 8px; position: relative; overflow: visible; background: linear-gradient(90deg, #FF5039, #FF6756); border: 2px solid #FF5039; transition: all 0.2s ease;" onmouseover="this.style.background='linear-gradient(90deg, #FFC938, #6ACFD1)'; this.style.borderColor='#FFC938'" onmouseout="this.style.background='linear-gradient(90deg, #FF5039, #FF6756)'; this.style.borderColor='#FF5039'">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="flex-shrink: 0;">
          <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
        </svg>
        <span class="btn-text" style="font-weight: 600;">STAR ON GITHUB</span>
        <!-- Star count badge -->
        <span class="star-count-badge" style="background: rgba(255,255,255,0.9); color: #FF5039; padding: 3px 6px; font-size: 0.7rem; font-weight: 900; border: 1px solid rgba(255,80,57,0.3);">
          {starCount}
        </span>
      </a>
    </div>

    <div class="mobile-nav" style="display: none; align-items: center; gap: 12px;">
      <button id="lang-toggle-mobile" class="btn-lang mobile-lang-btn" style="gap: 4px; padding: 8px 10px;">
        <span id="current-lang-mobile">üá∫üá∏</span>
      </button>

      <button id="mobile-menu-toggle" class="mobile-menu-btn" style="border: none; background: none; padding: 8px; cursor: pointer;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
    </div>
  </nav>

  <div id="mobile-menu" class="mobile-dropdown" style="display: none; background: white; border-bottom: 2px solid var(--mondrian-black); box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <div class="container" style="padding: 16px; display: flex; flex-direction: column; gap: 12px;">
      <!-- Products Section -->
      <div class="mobile-section" style="border-bottom: 1px solid #eee; padding-bottom: 12px; margin-bottom: 12px;">
        <div class="mobile-section-title" style="font-weight: 600; color: #666; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 8px;" data-en="Products" data-zh="‰∫ßÂìÅ">Products</div>
        <a href="/" class="mobile-nav-link" style="padding-left: 12px;">
          <span class="link-text" data-en="MoFA Framework" data-zh="MoFA Core">MoFA Framework</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 9.75L12 3l9 6.75V21a1 1 0 0 1 -1 1h-5v-6h-6v6H4a1 1 0 0 1-1-1V9.75z" />
          </svg>
        </a>
        <a href="/mofa-stage" class="mobile-nav-link" style="padding-left: 12px;">
          <span class="link-text" data-en="MoFA Stage" data-zh="MoFA Stage">MoFA Stage</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </a>
      </div>

      <!-- Main Navigation -->
      <a href="/docs" class="mobile-nav-link">
        <span class="link-text" data-en="Docs" data-zh="ÊñáÊ°£">Docs</span>
        <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/>
          <polyline points="14,2 14,8 20,8" fill="none" stroke="currentColor" stroke-width="1"/>
          <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="1"/>
          <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="1"/>
          <line x1="13" y1="9" x2="8" y2="9" stroke="currentColor" stroke-width="1"/>
        </svg>
      </a>
      <a href="/blog" class="mobile-nav-link">
        <span class="link-text" data-en="Blog" data-zh="ÂçöÂÆ¢">Blog</span>
        <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/>
        </svg>
      </a>

      <!-- Hackathons Section -->
      <div class="mobile-section" style="border-top: 1px solid #eee; padding-top: 12px; margin-top: 12px;">
        <div class="mobile-section-title" style="font-weight: 600; color: #666; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 8px;" data-en="Hackathons" data-zh="ÈªëÂÆ¢Êùæ">Hackathons</div>
        <a href="/#hall-of-fame" class="mobile-nav-link" style="padding-left: 12px;">
          <span class="link-text" data-en="Developer Hall of Fame" data-zh="ÂºÄÂèëËÄÖÊÆøÂ†Ç">Developer Hall of Fame</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </a>
        <a href="/super-agent-hackathon" class="mobile-nav-link" style="padding-left: 12px;">
          <span class="link-text" data-en="Super Agent Campathon 2025" data-zh="Ë∂ÖÁ∫ßÊô∫ËÉΩ‰ΩìÈªëÂÆ¢Êùæ 2025">Super Agent Campathon 2025</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/>
            <polyline points="14,2 14,8 20,8" fill="none" stroke="currentColor" stroke-width="1"/>
            <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="1"/>
            <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="1"/>
            <line x1="13" y1="9" x2="8" y2="9" stroke="currentColor" stroke-width="1"/>
          </svg>
        </a>
        <a href="https://hackathon.mofa.ai" class="mobile-nav-link" target="_blank" rel="noopener noreferrer" style="padding-left: 12px;">
          <span class="link-text" data-en="Code Alert Hackathon 2025" data-zh="Code Alert ÈªëÂÆ¢Êùæ 2025">Code Alert Hackathon 2025</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
          </svg>
        </a>
        <a href="https://gobi.upstreamlabs.org/en/" class="mobile-nav-link" target="_blank" rel="noopener noreferrer" style="padding-left: 12px;">
          <span class="link-text" data-en="Global Open Source Business Innovation Conference 2025" data-zh="ÂÖ®ÁêÉÂºÄÊ∫êÂïÜ‰∏öÂàõÊñ∞Â§ß‰ºö 2025">Global Open Source Business Innovation Conference 2025</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
          </svg>
        </a>
      </div>

      <!-- Community Section -->
      <div class="mobile-section" style="border-top: 1px solid #eee; padding-top: 12px; margin-top: 12px;">
        <div class="mobile-section-title" style="font-weight: 600; color: #666; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 8px;" data-en="Community" data-zh="Á§æÂå∫">Community</div>
        <a href="https://discord.gg/hKJZzDMMm9" class="mobile-nav-link" target="_blank" rel="noopener noreferrer" style="padding-left: 12px;">
          <span class="link-text" data-en="Discord Community" data-zh="Discord Á§æÂå∫">Discord Community</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a19.7363 19.7363 0 00-4.8852 1.515C.5334 9.0458-.319 13.5799.0992 18.0578c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294.4616-.6304.8731-1.2952 1.226-1.9942-.6528-.2476-1.2743-.5495-1.8722-.8923.1258-.0943.2517-.1923.3718-.2914 3.9278 1.7933 8.18 1.7933 12.0614 0 .1202.099.246.1981.3728.2924-.6528.2476-1.2743.5495-1.873.8914.3604.698.7719 1.3628 1.225 1.9932 1.961-.6067 3.9495-1.5219 6.0023-3.0294.5004-5.177-.8382-9.6739-3.5485-13.6604z" />
          </svg>
        </a>
        <a href="#" id="wechat-mobile-link" class="mobile-nav-link" style="padding-left: 12px; cursor: pointer;">
          <span class="link-text" data-en="WeChat Group" data-zh="ÂæÆ‰ø°Áæ§">WeChat Group</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178 1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826 0 1.622-.12 2.361-.336a.722.722 0 0 1 .598.082l1.584.926a.272.272 0 0 0 .14.047c.134 0 .24-.111.24-.247 0-.06-.023-.12-.038-.177l-.327-1.233a.582.582 0 0 1-.023-.156.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982z"/>
          </svg>
        </a>
        <a href="https://github.com/mofa-org/mofa/tree/main/documents" class="mobile-nav-link" target="_blank" rel="noopener noreferrer" style="padding-left: 12px;">
          <span class="link-text" data-en="Contributing Guide" data-zh="Ë¥°ÁåÆÊåáÂçó">Contributing Guide</span>
          <svg class="icon-right" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
          </svg>
        </a>
        <a href="https://github.com/mofa-org/mofa" class="mobile-nav-link github-star-mobile" target="_blank" rel="noopener noreferrer" style="position: relative; padding: 12px; margin: 4px 0; background: linear-gradient(90deg, #FF5039, #FF6756); border: 2px solid #FF5039; color: white; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s ease;" onmouseover="this.style.background='linear-gradient(90deg, #FFC938, #6ACFD1)'; this.style.borderColor='#FFC938'" onmouseout="this.style.background='linear-gradient(90deg, #FF5039, #FF6756)'; this.style.borderColor='#FF5039'">
          <div style="display: flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
            </svg>
            <span class="link-text" style="font-weight: 600;">STAR ON GITHUB </span>
          </div>
          <!-- Mobile star badge -->
          <span class="star-count-mobile" style="background: rgba(255,255,255,0.9); color: #FF5039; padding: 3px 8px; font-size: 0.7rem; font-weight: 900; border: 1px solid rgba(255,80,57,0.3);">
            {starCount}
          </span>
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const langToggle = document.getElementById('lang-toggle');
    const currentLang = document.getElementById('current-lang');
    let isEnglish = true;

    if (langToggle && currentLang) {
      langToggle.addEventListener('click', function() {
        isEnglish = !isEnglish;

        if (isEnglish) {
          currentLang.textContent = 'üá∫üá∏ EN';
          // ÂàáÊç¢Âà∞Ëã±Êñá
          document.querySelectorAll('[data-en]').forEach(el => {
            if (el.tagName === 'INPUT' && el.type === 'submit') {
              el.value = el.getAttribute('data-en') || el.value;
            } else if (el.classList.contains('dropdown-toggle')) {
              // ÂØπ‰∫é‰∏ãÊãâÊåâÈíÆÔºåÂè™Êõ¥Êñ∞ÂÜÖÈÉ®spanÁöÑÊñáÊú¨Ôºå‰øùÁïôsvgÂõæÊ†á
              const span = el.querySelector('span');
              if (span) {
                span.textContent = el.getAttribute('data-en') || span.textContent;
              }
            } else {
              el.innerHTML = el.getAttribute('data-en') || el.innerHTML;
            }
          });
        } else {
          currentLang.textContent = 'üá®üá≥ ‰∏≠Êñá';
          // ÂàáÊç¢Âà∞‰∏≠Êñá
          document.querySelectorAll('[data-zh]').forEach(el => {
            if (el.tagName === 'INPUT' && el.type === 'submit') {
              el.value = el.getAttribute('data-zh') || el.value;
            } else if (el.classList.contains('dropdown-toggle')) {
              // ÂØπ‰∫é‰∏ãÊãâÊåâÈíÆÔºåÂè™Êõ¥Êñ∞ÂÜÖÈÉ®spanÁöÑÊñáÊú¨Ôºå‰øùÁïôsvgÂõæÊ†á
              const span = el.querySelector('span');
              if (span) {
                span.textContent = el.getAttribute('data-zh') || span.textContent;
              }
            } else {
              el.innerHTML = el.getAttribute('data-zh') || el.innerHTML;
            }
          });
        }
      });
    }

    // ÁßªÂä®Á´ØËèúÂçï‰∫§‰∫í
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const langToggleMobile = document.getElementById('lang-toggle-mobile');
    const currentLangMobile = document.getElementById('current-lang-mobile');

    // Ê±âÂ†°ËèúÂçïÂàáÊç¢
    if (mobileMenuToggle && mobileMenu) {
      mobileMenuToggle.addEventListener('click', function() {
        if (mobileMenu.style.display === 'none' || !mobileMenu.style.display) {
          mobileMenu.style.display = 'block';
        } else {
          mobileMenu.style.display = 'none';
        }
      });

      // ÁÇπÂáªÂ§ñÈÉ®Âå∫ÂüüÂÖ≥Èó≠ËèúÂçï
      document.addEventListener('click', function(e) {
        if (!mobileMenuToggle.contains(e.target) && !mobileMenu.contains(e.target)) {
          mobileMenu.style.display = 'none';
        }
      });
    }

    // ÁßªÂä®Á´ØËØ≠Ë®ÄÂàáÊç¢
    if (langToggleMobile) {
      langToggleMobile.addEventListener('click', function() {
        // Ëß¶ÂèëÊ°åÈù¢Á´ØÁöÑËØ≠Ë®ÄÂàáÊç¢ÈÄªËæë
        if (langToggle) {
          langToggle.click();
        }
      });
    }

    // ÂêåÊ≠•ÁßªÂä®Á´ØËØ≠Ë®ÄÊòæÁ§∫
    function updateMobileLanguageDisplay() {
      if (currentLangMobile && currentLang) {
        const flag = currentLang.textContent.includes('üá∫üá∏') ? 'üá∫üá∏' : 'üá®üá≥';
        currentLangMobile.textContent = flag;
      }
    }

    // ÁõëÂê¨Ê°åÈù¢Á´ØËØ≠Ë®ÄÂàáÊç¢ÔºåÂêåÊ≠•Âà∞ÁßªÂä®Á´Ø
    if (langToggle) {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'childList' || mutation.type === 'characterData') {
            updateMobileLanguageDisplay();
          }
        });
      });

      observer.observe(currentLang, {
        childList: true,
        subtree: true,
        characterData: true
      });
    }

    // ÂàùÂßãÂåñÁßªÂä®Á´ØËØ≠Ë®ÄÊòæÁ§∫
    updateMobileLanguageDisplay();

    // ‰∏ãÊãâËèúÂçï‰∫§‰∫í
    const dropdowns = document.querySelectorAll('.nav-dropdown');
    dropdowns.forEach(dropdown => {
      const toggle = dropdown.querySelector('.dropdown-toggle');
      const menu = dropdown.querySelector('.dropdown-menu');

      if (toggle && menu) {
        // Click to toggle
        toggle.addEventListener('click', (e) => {
          e.stopPropagation();

          // Close other dropdowns
          dropdowns.forEach(otherDropdown => {
            if (otherDropdown !== dropdown) {
              const otherMenu = otherDropdown.querySelector('.dropdown-menu');
              if (otherMenu) {
                otherMenu.style.opacity = '0';
                otherMenu.style.visibility = 'hidden';
                otherMenu.style.transform = 'translateY(-10px)';
              }
            }
          });

          // Toggle current dropdown
          const isVisible = menu.style.visibility === 'visible';
          if (isVisible) {
            menu.style.opacity = '0';
            menu.style.visibility = 'hidden';
            menu.style.transform = 'translateY(-10px)';
          } else {
            menu.style.opacity = '1';
            menu.style.visibility = 'visible';
            menu.style.transform = 'translateY(0)';
          }
        });

        // Hover effects
        dropdown.addEventListener('mouseenter', () => {
          menu.style.opacity = '1';
          menu.style.visibility = 'visible';
          menu.style.transform = 'translateY(0)';
        });

        dropdown.addEventListener('mouseleave', () => {
          menu.style.opacity = '0';
          menu.style.visibility = 'hidden';
          menu.style.transform = 'translateY(-10px)';
        });
      }
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', () => {
      dropdowns.forEach(dropdown => {
        const menu = dropdown.querySelector('.dropdown-menu');
        if (menu) {
          menu.style.opacity = '0';
          menu.style.visibility = 'hidden';
          menu.style.transform = 'translateY(-10px)';
        }
      });
    });

    // Add hover effects for dropdown items
    const dropdownItems = document.querySelectorAll('.dropdown-item');
    dropdownItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        item.style.backgroundColor = '#f5f5f5';
      });
      item.addEventListener('mouseleave', () => {
        item.style.backgroundColor = 'white';
      });
    });

    // WeChat modal handlers
    const wechatHeaderLink = document.getElementById('wechat-header-link');
    const wechatMobileLink = document.getElementById('wechat-mobile-link');
    const wechatModal = document.getElementById('wechat-modal');

    function openWechatModal(e) {
      if (e) e.preventDefault();
      if (wechatModal) {
        wechatModal.style.display = 'flex';
      }
    }

    if (wechatHeaderLink) {
      wechatHeaderLink.addEventListener('click', openWechatModal);
    }

    if (wechatMobileLink) {
      wechatMobileLink.addEventListener('click', openWechatModal);
    }
  });
</script>
